P8105_hw3_my2838
================

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(ggplot2)
library(dplyr)
```

# Problem 1

``` r
homicide = 
  read_csv("homicide-data.csv") |>
  mutate(city_state = paste(city, state, sep = ","))
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
homicide_city = 
  homicide |>
  group_by(city_state, disposition) |>
  count(disposition) |>
  pivot_wider(
    names_from = disposition,
    values_from = n
  ) |>
  janitor::clean_names() |>
  mutate_all(~replace_na(., 0)) |>
  mutate(unsolved = closed_without_arrest + open_no_arrest,
         sum = closed_without_arrest + open_no_arrest + closed_by_arrest) 
```

    ## `mutate_all()` ignored the following grouping variables:
    ## • Column `city_state`
    ## ℹ Use `mutate_at(df, vars(-group_cols()), myoperation)` to silence the message.

``` r
prop_bal = 
  prop.test(
  x = homicide_city$unsolved[homicide_city$city_state == "Baltimore,MD" ],
  n = homicide_city$sum[homicide_city$city_state == "Baltimore,MD" ]
  ) |>
  broom::tidy() 

prop_bal |>
  knitr::kable()
```

|  estimate | statistic | p.value | parameter |  conf.low | conf.high | method                                               | alternative |
|----------:|----------:|--------:|----------:|----------:|----------:|:-----------------------------------------------------|:------------|
| 0.6455607 |   239.011 |       0 |         1 | 0.6275625 | 0.6631599 | 1-sample proportions test with continuity correction | two.sided   |

So the estimate proportion of homicides that are unsolved in the city of
Baltimore, MD is 0.6455607, and the confidence interval is \[0.6275625,
0.6631599\].

``` r
prop_test = function (city_name) {
    prop.test(
  x = homicide_city$unsolved[homicide_city$city_state == city_name ],
  n = homicide_city$sum[homicide_city$city_state == city_name ]
  ) |>
    broom::tidy()
}

purrr::map_df(pull(homicide_city, city_state), prop_test)
```

    ## Warning in prop.test(x = homicide_city$unsolved[homicide_city$city_state == :
    ## Chi-squared approximation may be incorrect

    ## # A tibble: 51 × 8
    ##    estimate statistic   p.value parameter conf.low conf.high method  alternative
    ##       <dbl>     <dbl>     <dbl>     <int>    <dbl>     <dbl> <chr>   <chr>      
    ##  1    0.386   19.1    1.23e-  5         1    0.337     0.438 1-samp… two.sided  
    ##  2    0.383   52.5    4.32e- 13         1    0.353     0.415 1-samp… two.sided  
    ##  3    0.646  239.     6.46e- 54         1    0.628     0.663 1-samp… two.sided  
    ##  4    0.462    2.27   1.32e-  1         1    0.414     0.511 1-samp… two.sided  
    ##  5    0.434   13.8    2.05e-  4         1    0.399     0.469 1-samp… two.sided  
    ##  6    0.505    0.0407 8.40e-  1         1    0.465     0.545 1-samp… two.sided  
    ##  7    0.612   25.8    3.73e-  7         1    0.569     0.654 1-samp… two.sided  
    ##  8    0.300  109.     1.41e- 25         1    0.266     0.336 1-samp… two.sided  
    ##  9    0.736 1231.     1.28e-269         1    0.724     0.747 1-samp… two.sided  
    ## 10    0.445    8.11   4.41e-  3         1    0.408     0.483 1-samp… two.sided  
    ## # ℹ 41 more rows
